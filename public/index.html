<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📱</text></svg>">
  <title>Web Scrcpy - Android 远程控制</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- 登录遮罩 -->
  <div id="login-overlay" class="login-overlay">
    <div class="login-box">
      <h2>🔐 输入密码</h2>
      <form class="login-form" onsubmit="handleLogin(event)">
        <input type="password" id="password-input" class="login-input" placeholder="请输入访问密码"
          autocomplete="current-password" required />
        <div id="login-error" class="login-error"></div>
        <button type="submit" class="login-btn">进入</button>
      </form>
    </div>
  </div>

  <!-- 悬浮状态栏 -->
  <div id="status" class="status info" style="display: none;"></div>

  <div class="container">
    <!-- 头部 -->
    <div class="header">
      <h1><span class="emoji">📱</span><span class="title-text">Web Scrcpy</span></h1>
    </div>

    <!-- 手机模拟器容器 -->
    <div class="phone-container">
      <!-- 信息按钮 -->
      <button id="stats-toggle-btn" class="stats-toggle-btn" onclick="toggleStats()" title="统计信息">!</button>

      <!-- 屏幕显示 -->
      <div class="screen-container">
        <!-- 统计显示面板 -->
        <div id="stats-display" class="stats-panel">
          <button class="stats-close-btn" onclick="toggleStats()" title="关闭">✕</button>
        </div>

        <img id="screen" alt="Android Screen" style="display: none;" />
        <!-- 未连接提示 -->
        <div id="screen-placeholder" class="screen-placeholder">
          <div class="placeholder-icon">📱</div>
          <div class="placeholder-text">请选择设备开始投屏</div>
        </div>
        <!-- 加载动画 -->
        <div id="screen-loader" class="screen-loader" style="display: none;">
          <div class="spinner"></div>
          <div class="loader-text">正在连接设备...</div>
        </div>
        <!-- 断开连接遮罩 -->
        <div id="screen-broken" class="screen-broken" style="display: none;">
          <div class="broken-overlay"></div>
          <div class="broken-message">
            <div class="broken-icon">⚠️</div>
            <div class="broken-text">连接已断开</div>
            <div class="broken-hint">请重新连接设备</div>
          </div>
        </div>
      </div>

      <!-- Android 导航栏 -->
      <div class="navbar">
        <button class="nav-btn" onclick="sendKey(4)" title="返回">◁</button>
        <button class="nav-btn home" onclick="sendKey(3)" title="主页">○</button>
        <button class="nav-btn" onclick="sendKey(187)" title="最近任务">▢</button>
      </div>

      <!-- 侧边功能按钮 -->
      <div class="side-buttons">
        <button class="side-btn" onclick="sendKey(26)" data-tooltip="电源" title="电源">🔆</button>
        <button class="side-btn" onclick="sendKey(24)" data-tooltip="音量+" title="音量+">🔊</button>
        <button class="side-btn" onclick="sendKey(25)" data-tooltip="音量-" title="音量-">🔉</button>
      </div>
    </div>

    <!-- 提示信息 -->
    <!-- <div class="info-box">
      请确保已安装 ADB 和 scrcpy，并且设备已通过 USB 连接或无线连接<br>
      使用 H264 视频流模式，需要浏览器支持 WebCodecs (Chrome 94+)
    </div> -->

    <!-- 设备区域 -->
    <div class="device-section">
      <!-- 主标签页 -->
      <div class="main-tabs">
        <button class="main-tab-btn active" onclick="switchMainTab('devices')">📱 可用设备</button>
        <button class="main-tab-btn" onclick="switchMainTab('management')">⚙️ 设备管理</button>
      </div>

      <!-- 可用设备内容 -->
      <div id="tab-devices" class="tab-content active">
        <div class="device-header">
          <h2>设备列表</h2>
          <button id="refresh" class="refresh-btn">刷新</button>
        </div>

        <!-- 标签页 -->
        <div class="device-tabs">
          <button class="tab-btn active" data-filter="all">
            全部<span class="tab-count" id="count-all">0</span>
          </button>
          <button class="tab-btn" data-filter="online">
            在线<span class="tab-count" id="count-online">0</span>
          </button>
          <button class="tab-btn" data-filter="offline">
            离线<span class="tab-count" id="count-offline">0</span>
          </button>
        </div>

        <div id="device-list" class="device-list">
          <div class="loading">
            <div class="spinner"></div>
            <div>正在扫描设备...</div>
          </div>
        </div>

        <!-- H264 视频流设置 -->
        <div class="settings-row">
          <div class="setting-group setting-group-bitrate">
            <label for="bitrate-input">码率</label>
            <div class="bitrate-input-group">
              <input type="number" id="bitrate-input" class="bitrate-input" value="2" min="0.1" max="100" step="0.1" />
              <select id="bitrate-unit" class="bitrate-unit">
                <option value="1000000" selected>Mbps</option>
                <option value="1000">Kbps</option>
              </select>
            </div>
          </div>

          <div class="setting-group">
            <label for="resolution-select">分辨率</label>
            <select id="resolution-select">
              <option value="480">480p</option>
              <option value="640">640p</option>
              <option value="720">720p</option>
              <option value="1080" selected>1080p</option>
              <option value="1280">1280p</option>
              <option value="1920">1920p</option>
              <option value="0">原始</option>
            </select>
          </div>

          <div class="setting-group">
            <label for="fps-select">帧率</label>
            <select id="fps-select">
              <option value="15">15 FPS</option>
              <option value="24">24 FPS</option>
              <option value="30" selected>30 FPS</option>
              <option value="60">60 FPS</option>
              <option value="90">90 FPS</option>
              <option value="120">120 FPS</option>
            </select>
          </div>
        </div>
      </div>

      <!-- 设备管理内容 -->
      <div id="tab-management" class="tab-content">
        <div class="device-actions">
          <h3>📡 无线连接</h3>
          <div class="device-action-form">
            <input type="text" id="device-address-input" class="device-input"
              placeholder="输入设备IP:端口 (例如: 192.168.1.100:5555)" />
            <button class="action-btn action-btn-primary" onclick="connectDevice()">连接</button>
            <button class="action-btn action-btn-danger" onclick="disconnectDevice()">断开</button>
          </div>
          <div class="device-hint">例如: 192.168.1.100:5555</div>
        </div>
      </div>
    </div>
  </div>

  <!-- 底部 -->
  <footer class="footer">
    <div class="footer-content">
      <a href="https://github.com/XingHehy" target="_blank" rel="noopener noreferrer" class="footer-link footer-author">
        XingHehy
      </a>
      <span>|</span>
      <a href="https://github.com/XingHehy/web-scrcpy-min" target="_blank" rel="noopener noreferrer"
        class="footer-link">
        GitHub
      </a>
    </div>
  </footer>

  <script src="main.js"></script>
</body>

</html>